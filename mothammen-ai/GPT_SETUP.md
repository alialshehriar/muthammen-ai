# 🤖 دليل تفعيل وكيل GPT المتقدم

هذا الملف يشرح كيفية ربط التطبيق مع وكيل GPT للحصول على تقييمات أكثر دقة وتحليل شامل.

---

## 📋 المتطلبات

1. **حساب OpenAI** مع API Key نشط
2. **رصيد كافٍ** في حساب OpenAI (التقييم الواحد يستهلك تقريباً 0.01-0.05$)

---

## ⚙️ خطوات التفعيل

### الخطوة 1: الحصول على API Key

1. سجّل دخول إلى [platform.openai.com](https://platform.openai.com)
2. اذهب إلى **API Keys** من القائمة الجانبية
3. اضغط على **Create new secret key**
4. انسخ المفتاح (سيظهر مرة واحدة فقط!)

### الخطوة 2: إضافة API Key للمشروع

1. افتح ملف `src/lib/apiConfig.js`
2. ابحث عن السطر التالي:
   ```javascript
   apiKey: '', // مثال: 'sk-proj-xxxxxxxxxxxxx'
   ```
3. ضع مفتاح API الخاص بك بين علامتي التنصيص:
   ```javascript
   apiKey: 'sk-proj-YOUR_ACTUAL_API_KEY_HERE',
   ```
4. احفظ الملف

### الخطوة 3: إعادة تشغيل التطبيق

- إذا كان التطبيق يعمل محلياً، أعد تشغيل خادم التطوير:
  ```bash
  npm run dev
  ```
- إذا كان منشوراً على Vercel، ارفع التغييرات إلى GitHub وسيتم النشر تلقائياً

---

## 🎯 كيفية الاستخدام

بعد تفعيل API Key:

1. افتح التطبيق
2. اضغط على زر **الإعدادات** في الأعلى
3. ستجد خيار **استخدام GPT** - قم بتفعيله
4. املأ بيانات العقار واضغط **احسب القيمة التقديرية**
5. سيتم إرسال البيانات إلى وكيل GPT وستحصل على:
   - تقييم دقيق بناءً على تحليل متعدد الأدوار
   - تحليل شامل للعوامل المؤثرة
   - مقارنة مع السوق
   - نقاط القوة والضعف
   - رؤى السوق واتجاهاته
   - توصيات لتحسين القيمة
   - درجة استثمارية من 10

---

## 🧠 كيف يعمل وكيل GPT؟

عند تفعيل GPT، يتم إرسال بيانات العقار مع **System Prompt متقدم** يوجه الوكيل ليلعب عدة أدوار:

1. **خبير تقييم عقاري معتمد** (20+ سنة خبرة)
2. **محلل بيانات سوق عقاري**
3. **مستشار استثماري عقاري**
4. **خبير تسعير استراتيجي**

الوكيل يتبع منهجية من 6 خطوات:
- التحليل الأساسي
- تحليل الخصائص الفيزيائية
- تحليل الموقع والمحيط
- تحليل السوق
- التعديلات الدقيقة
- التحقق والمراجعة

---

## 📊 التعلم التدريجي

- يتم حفظ جميع التقييمات (سواء من المحرك المحلي أو GPT) في `localStorage`
- عند كل طلب جديد، يتم إرسال آخر 10 تقييمات للوكيل
- يستخدم الوكيل هذه البيانات للتعلم وتحسين دقته بناءً على:
  - الأنماط المتكررة في نفس المناطق
  - التغيرات في الأسعار عبر الزمن
  - العوامل الأكثر تأثيراً في كل منطقة

---

## 💰 التكلفة المتوقعة

- **النموذج المستخدم**: `gpt-4o` (يمكن تغييره في `apiConfig.js`)
- **التكلفة التقريبية**: 0.01$ - 0.05$ لكل تقييم
- **الاستهلاك الشهري** (100 تقييم): 1$ - 5$

لتقليل التكلفة، يمكنك تغيير النموذج إلى `gpt-3.5-turbo` في ملف `apiConfig.js`:
```javascript
model: 'gpt-3.5-turbo', // بدلاً من 'gpt-4o'
```

---

## 🔒 الأمان

⚠️ **تحذير مهم:**
- **لا تشارك** API Key مع أحد
- **لا ترفع** الملف `apiConfig.js` مع API Key إلى GitHub العام
- استخدم **متغيرات البيئة** (Environment Variables) في Vercel:
  1. في لوحة تحكم Vercel، اذهب إلى **Settings** -> **Environment Variables**
  2. أضف متغير جديد: `VITE_OPENAI_API_KEY` = قيمة API Key
  3. في `apiConfig.js`، استخدم:
     ```javascript
     apiKey: import.meta.env.VITE_OPENAI_API_KEY || '',
     ```

---

## 🛠️ تخصيص System Prompt

يمكنك تعديل توجيهات الوكيل في ملف `apiConfig.js`:

ابحث عن `AGENT_SYSTEM_PROMPT` وعدّل النص حسب احتياجك. مثلاً:
- تغيير التركيز (مثلاً: التركيز أكثر على الاستثمار)
- إضافة معايير خاصة بمنطقة معينة
- تعديل أسلوب الرد (أكثر تفصيلاً أو أكثر اختصاراً)

---

## ❓ استكشاف الأخطاء

### الخطأ: "API غير مفعّل"
- تأكد من إضافة API Key في `apiConfig.js`
- تأكد من حفظ الملف وإعادة تشغيل التطبيق

### الخطأ: "API Error: Incorrect API key"
- تأكد من نسخ API Key بشكل صحيح (بدون مسافات إضافية)
- تأكد من أن المفتاح لم يتم حذفه من حساب OpenAI

### الخطأ: "API Error: You exceeded your quota"
- رصيدك في OpenAI منتهي، قم بإضافة رصيد جديد

### التطبيق يستخدم المحرك المحلي بدلاً من GPT
- تأكد من تفعيل خيار "استخدام GPT" في الإعدادات
- تحقق من وجود API Key في `apiConfig.js`

---

## 📞 الدعم

إذا واجهت أي مشكلة:
1. راجع سجل المتصفح (Console) للأخطاء
2. تأكد من صحة API Key
3. تحقق من رصيد حساب OpenAI

---

**ملاحظة:** المحرك المحلي يعمل بشكل ممتاز ودقيق حتى بدون GPT. استخدام GPT اختياري للحصول على تحليل أعمق وتوصيات أكثر تفصيلاً.

